<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" class="no-js"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script><title>8.  Pragmas</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link href="https://purl.org/dc/elements/1.1/" rel="schema.dc"/><meta name="dc.modified" content="2022-09-04T15:24:51Z"/><meta name="generator" content="DocBook xslTNG version 1.8.0 / 4af8cdde / SAXON HE 10.6"/><link href="/css/toc.css" rel="stylesheet"/><link href="/css/docbook.css" rel="stylesheet"/><link href="/css/docbook-screen.css" rel="stylesheet" media="screen"/><link href="/css/docbook-page-setup.css" rel="stylesheet" media="print"/><link href="/css/docbook-paged.css" rel="stylesheet" media="print"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><script src="https://kit.fontawesome.com/498b6706f0.js" type="text/javascript" crossorigin="anonymous"></script><link href="icon/CoffeePot.png" rel="shortcut icon"/><link href="/css/nineml.css" rel="stylesheet"/><link href="/css/coffeepot.css" rel="stylesheet"/><link rel="prev" href="ch07.html"/><link rel="next" href="ch09.html"/><link rel="up" href="index.html"/><link rel="home" href="index.html"/></head><body><nav class="top"><span class="nav"><a title="CoffeePot" href="index.html"><i class="fas fa-home"></i></a> <a href="ch07.html" title="7.  Output formats"><i class="fas fa-arrow-left"></i></a> <a title="CoffeePot" href="index.html"><i class="fas fa-arrow-up"></i></a> <a title="9.  Parsing records" href="ch09.html"><i class="fas fa-arrow-right"></i></a></span><span class="title"><i class="title">CoffeePot</i></span></nav><main><div id="pragmas" class="chapter component"><header><h2><span class="number">8<span class="sep">. </span></span>Pragmas</h2></header><p>It’s possible to influence the behavior of the processor by placing
pragmas in your grammar.</p><div class="admonition important"><div><div class="icon">☝︎</div><div class="body"><header><div class="title">Experimental</div></header><div><p>Pragmas are a separate feature; they are not part of Invisible XML 1.0.
As of 4 September 2022, the pragma syntax accepted by
<a href="https://coffeefilter.nineml.org/" class="link">CoffeeFilter</a> (and
<span class="application">CoffeePot</span>) has been updated to the grammar described in
<i class="citetitle"><a href="https://balisage.net/Proceedings/vol27/html/Sperberg-McQueen01/BalisageVol27-Sperberg-McQueen01.html"><a href="https://balisage.net/Proceedings/vol27/html/Sperberg-McQueen01/BalisageVol27-Sperberg-McQueen01.html">Designing for change: Pragmas in Invisible XML as an extensibility
mechanism</a></a></i> presented at
<a href="https://balisage.net/" class="link">Balisage</a>, 2022.</p><p>If you run <span class="application">CoffeePot</span> with the
<code class="option">--pedantic</code> option, you cannot use pragmas.</p></div></div></div></div><p>A pragma begins with “<code>{[</code>” and is followed by a pragma
name, pragma data (which may be empty), and closes with
“<code>]}</code>”. The pragma name is a shortcut for a URI which provides
the “real” identity of the pragma. This mechanism leverages URI space to achieve
distributed extensibility.</p><p>The mapping from names to URIs is done with the
“<code>pragma</code>” pragma at the top of your grammar. This, for example,
declares the name “<code>nineml</code>” as the pragma identified by the
URI “<code>https://nineml.org/ns/pragma/</code>”:</p><div class="pre-wrap" db-startinglinenumber="1" db-numberoflines="1"><pre class="language-none numbered programlisting verbatim verblines"><span class="line" db-line="1"><span class="ln"></span><span class="ld"><code>{[+pragma nineml "https://nineml.org/ns/pragma/"]}</code></span></span>
</pre></div><p><span class="application">CoffeePot</span> ignores any pragmas it does
not recognize. The rest of this document assumes that you have
declared the pragma name “<code>nineml</code>” as shown above. You
must do this in every grammar file where you use pragmas.</p><p>Pragmas can be associated with the entire grammar or with a rule,
a nonterminal symbol, or a terminal symbol:</p><ol class="orderedlist" type="1"><li><p>A pragma placed before a symbol applies to the symbol that follows it:
</p><div class="pre-wrap" db-startinglinenumber="1" db-numberoflines="2"><pre class="language-none numbered programlisting verbatim verblines"><span class="line" db-line="1"><span class="ln"></span><span class="ld"><code>rule: {[pragma applies to “A”]} A,</code></span></span>
<span class="line" db-line="2"><span class="ln"></span><span class="ld"><code>      {[pragma applies to “b”]} 'b'.</code></span></span>
</pre></div></li><li><p>A pragma placed before a rule, applies to the rule that follows it:
</p><div class="pre-wrap" db-startinglinenumber="1" db-numberoflines="3"><pre class="language-none numbered programlisting verbatim verblines"><span class="line" db-line="1"><span class="ln"></span><span class="ld"><code>{[pragma applies to “rule”]}</code></span></span>
<span class="line" db-line="2"><span class="ln"></span><span class="ld"><code>rule: {[pragma applies to “A”]} A,</code></span></span>
<span class="line" db-line="3"><span class="ln"></span><span class="ld"><code>      {[pragma applies to “b”]} 'b'.</code></span></span>
</pre></div></li><li><p>To apply a pragma to the entire grammar, it must precede the first rule
and it must be followed by a full stop:</p><div class="pre-wrap" db-startinglinenumber="1" db-numberoflines="5"><pre class="language-none long numbered programlisting verbatim verblines"><span class="line" db-line="1"><span class="ln">1</span><span class="ld"><code>{[pragma applies to whole grammar]} .</code></span></span>
<span class="line" db-line="2"><span class="ln"></span><span class="ld"><code> </code></span></span>
<span class="line" db-line="3"><span class="ln"></span><span class="ld"><code>{[pragma applies to “rule”]}</code></span></span>
<span class="line" db-line="4"><span class="ln"></span><span class="ld"><code>rule: {[pragma applies to “A”]} A,</code></span></span>
<span class="line" db-line="5"><span class="ln">5</span><span class="ld"><code>      {[pragma applies to “b”]} 'b'.</code></span></span>
</pre></div></li></ol><p>More than one pragma can appear at any of those locations:</p><div class="pre-wrap" db-startinglinenumber="1" db-numberoflines="10"><pre class="language-none long numbered programlisting verbatim verblines"><span class="line" db-line="1"><span class="ln">1</span><span class="ld"><code>{[pragma applies to whole grammar]} .</code></span></span>
<span class="line" db-line="2"><span class="ln"></span><span class="ld"><code>{[second pragma applies to whole grammar ]} .</code></span></span>
<span class="line" db-line="3"><span class="ln"></span><span class="ld"><code> </code></span></span>
<span class="line" db-line="4"><span class="ln"></span><span class="ld"><code>{[pragma applies to “rule”]}</code></span></span>
<span class="line" db-line="5"><span class="ln">5</span><span class="ld"><code>{[second pragma applies to “rule”]}</code></span></span>
<span class="line" db-line="6"><span class="ln"></span><span class="ld"><code>rule:</code></span></span>
<span class="line" db-line="7"><span class="ln"></span><span class="ld"><code>   {[pragma applies to “A”]}</code></span></span>
<span class="line" db-line="8"><span class="ln"></span><span class="ld"><code>   {[second pragma applies to “A”]} A,</code></span></span>
<span class="line" db-line="9"><span class="ln"></span><span class="ld"><code>   {[pragma applies to “b”]}</code></span></span>
<span class="line" db-line="10"><span class="ln">10</span><span class="ld"><code>   {[second pragma applies to “b”]} 'b'.</code></span></span>
</pre></div><p>If a pragma is not recognized, or does not apply, it is ignored.
<span class="application">CoffeePot</span> will generate debug-level log messages to alert you to
pragmas that it is ignoring.</p><section id="pragmas-grammar" class="section"><header><h2><span class="number">8<span class="sep">.</span>1<span class="sep"> </span></span>Grammar pragmas</h2></header><p>There are three pragmas that apply to a grammar as a whole.</p><section id="pragma-csv-columns" class="section"><header><h3><span class="number">8<span class="sep">.</span>1<span class="sep">.</span>1<span class="sep"> </span></span>csv-columns</h3></header><p>Identifies the columns to be output when
<a href="ch07.html#output-csv" class="link">CSV output</a> is selected.</p><p>Usage:</p><div class="pre-wrap"><pre class="synopsis verbatim verblines"><span class="line" db-line="1"><span class="ln"></span><span class="ld"><code>{[nineml csv-columns <em class="replaceable">list,of,names</em>]}</code></span></span>
</pre></div><p>Ordinarily, CSV formatted output includes all the columns in (roughly)
the order they occur in the XML. This pragma allows you to list the
columns you want output and the order in which you want them output.</p><p>If a column requested does not exist in the document, it is
ignored. An empty column is not produced.</p></section><section id="pragma-import" class="section"><header><h3><span class="number">8<span class="sep">.</span>1<span class="sep">.</span>2<span class="sep"> </span></span>import</h3></header><p>Usage:</p><div class="pre-wrap"><pre class="synopsis verbatim verblines"><span class="line" db-line="1"><span class="ln"></span><span class="ld"><code>{[nineml import "grammar-uri"]}</code></span></span>
</pre></div></section><section id="pragma-ns" class="section"><header><h3><span class="number">8<span class="sep">.</span>1<span class="sep">.</span>3<span class="sep"> </span></span>ns</h3></header><p>Usage:</p><div class="pre-wrap"><pre class="synopsis verbatim verblines"><span class="line" db-line="1"><span class="ln"></span><span class="ld"><code>{[nineml ns "namespace-uri"]}</code></span></span>
</pre></div></section><section id="pragma-record-end" class="section"><header><h3><span class="number">8<span class="sep">.</span>1<span class="sep">.</span>4<span class="sep"> </span></span>record-end</h3></header><p>The <code>record-end</code> pragma enables record-oriented processing by
default. It’s value is the regular expression that marks record ends. Unlike the
other pragmas, this one has a different URI binding. It is a grammar option and
must be placed at the beginning of your grammar:
</p><p>Usage:</p><div class="pre-wrap"><pre class="synopsis verbatim verblines"><span class="line" db-line="1"><span class="ln"></span><span class="ld"><code>{[+pragma opt "https://nineml.org/ns/pragma/options/"]}</code></span></span>
<span class="line" db-line="2"><span class="ln"></span><span class="ld"><code>{[+opt record-end "\n([^ ])"]}</code></span></span>
</pre></div></section><section id="pragma-record-start" class="section"><header><h3><span class="number">8<span class="sep">.</span>1<span class="sep">.</span>5<span class="sep"> </span></span>record-start</h3></header><p>The <code>record-start</code> pragma enables record-oriented processing by
default. It’s value is the regular expression that marks record starts. Unlike the
other pragmas, this one has a different URI binding. It is a grammar option and
must be placed at the beginning of your grammar:
</p><p>Usage:</p><div class="pre-wrap"><pre class="synopsis verbatim verblines"><span class="line" db-line="1"><span class="ln"></span><span class="ld"><code>{[+pragma opt "https://nineml.org/ns/pragma/options/"]}</code></span></span>
<span class="line" db-line="2"><span class="ln"></span><span class="ld"><code>{[+opt record-start "([^\\])\n"]}</code></span></span>
</pre></div></section></section><section id="pragmas-rules" class="section"><header><h2><span class="number">8<span class="sep">.</span>2<span class="sep"> </span></span>Rule pragmas</h2></header><p>There are four pragmas that apply to a rules.</p><section id="pragma-csv-heading" class="section"><header><h3><span class="number">8<span class="sep">.</span>2<span class="sep">.</span>1<span class="sep"> </span></span>csv-heading</h3></header><p>Usage:</p><div class="pre-wrap"><pre class="synopsis verbatim verblines"><span class="line" db-line="1"><span class="ln"></span><span class="ld"><code>{[nineml xmlns "Heading Title"]}</code></span></span>
</pre></div></section><section id="pragma-discard-empty" class="section"><header><h3><span class="number">8<span class="sep">.</span>2<span class="sep">.</span>2<span class="sep"> </span></span>discard-empty</h3></header><p>Usage:</p><div class="pre-wrap"><pre class="synopsis verbatim verblines"><span class="line" db-line="1"><span class="ln"></span><span class="ld"><code>{[nineml discard empty]}</code></span></span>
</pre></div></section><section id="pragma-combine" class="section"><header><h3><span class="number">8<span class="sep">.</span>2<span class="sep">.</span>3<span class="sep"> </span></span>combine</h3></header><p>Usage:</p><div class="pre-wrap"><pre class="synopsis verbatim verblines"><span class="line" db-line="1"><span class="ln"></span><span class="ld"><code>{[nineml combine]}</code></span></span>
</pre></div></section><section id="pragma-regex" class="section"><header><h3><span class="number">8<span class="sep">.</span>2<span class="sep">.</span>4<span class="sep"> </span></span>regex</h3></header><p>Usage:</p><div class="pre-wrap"><pre class="synopsis verbatim verblines"><span class="line" db-line="1"><span class="ln"></span><span class="ld"><code>{[nineml regex "regular expression"]}</code></span></span>
</pre></div></section></section><section id="pragmas-symbols" class="section"><header><h2><span class="number">8<span class="sep">.</span>3<span class="sep"> </span></span>Symbol pragmas</h2></header><p>There are two pragmas that apply to a symbols.</p><section id="pragma-rename" class="section"><header><h3><span class="number">8<span class="sep">.</span>3<span class="sep">.</span>1<span class="sep"> </span></span>rename</h3></header><p>Usage:</p><div class="pre-wrap"><pre class="synopsis verbatim verblines"><span class="line" db-line="1"><span class="ln"></span><span class="ld"><code>{[nineml rename newname]}</code></span></span>
</pre></div></section><section id="pragma-rewrite" class="section"><header><h3><span class="number">8<span class="sep">.</span>3<span class="sep">.</span>2<span class="sep"> </span></span>rewrite</h3></header><p>Usage:</p><div class="pre-wrap"><pre class="synopsis verbatim verblines"><span class="line" db-line="1"><span class="ln"></span><span class="ld"><code>{[nineml rewrite "new literal"]}</code></span></span>
</pre></div></section></section></div></main><nav class="bottom"><div class="navrow"><div class="navleft"><a title="7.  Output formats" href="ch07.html"><i class="fas fa-arrow-left"></i></a></div><div class="navmiddle"><a title="CoffeePot" href="index.html"><i class="fas fa-home"></i></a></div><div class="navright"><a title="9.  Parsing records" href="ch09.html"><i class="fas fa-arrow-right"></i></a></div></div><div class="navrow"><div class="navleft navtitle">7.  Output formats</div><div class="navmiddle"><a title="CoffeePot" href="index.html"><i class="fas fa-arrow-up"></i></a></div><div class="navright navtitle">9.  Parsing records</div></div><div class="infofooter"><span class="copyrightfooter">Copyright © 2022 Norman Walsh.</span></div><nav class="tocopen"></nav><nav class="toc"></nav><!-- Hide ToC details from user agents that don’t support JS --><script type="text/html" class="tocopen"><i class="far fa-book"></i></script><script type="text/html" class="toc"><header><span>Table of Contents</span><span class="close"><i class="far fa-window-close"></i></span><p class="ptoc-search"><input class="ptoc-search" placeholder="Search" style="width: 80%"/></p></header><div><ul class="toc"><li><a href="pf01.html">Introduction</a></li><li><a href="ch01.html"><span class="number">1<span class="sep">. </span></span>Installing CoffeePot</a></li><li><a href="ch02.html"><span class="number">2<span class="sep">. </span></span>Running CoffeePot</a><ul class="toc"><li><a href="ch02.html#cli"><span class="number">2<span class="sep">.</span>1<span class="sep"> </span></span>The command line</a></li><li><a href="ch02.html#buildtools"><span class="number">2<span class="sep">.</span>2<span class="sep"> </span></span>In build tools</a></li></ul></li><li><a href="ch03.html"><span class="number">3<span class="sep">. </span></span>How it works</a><ul class="toc"><li><a href="ch03.html#earleymapping01"><span class="number">3<span class="sep">.</span>1<span class="sep"> </span></span>Mapping a simple rule</a></li><li><a href="ch03.html#earleymapping02"><span class="number">3<span class="sep">.</span>2<span class="sep"> </span></span>Mapping alternatives</a></li><li><a href="ch03.html#earleymapping03"><span class="number">3<span class="sep">.</span>3<span class="sep"> </span></span>Mapping “x?”</a></li><li><a href="ch03.html#earleymapping03b"><span class="number">3<span class="sep">.</span>4<span class="sep"> </span></span>Mapping “(x1, x2)?”</a></li><li><a href="ch03.html#earleymapping04"><span class="number">3<span class="sep">.</span>5<span class="sep"> </span></span>Mapping “x*”</a></li><li><a href="ch03.html#earleymapping05"><span class="number">3<span class="sep">.</span>6<span class="sep"> </span></span>Mapping “x+”</a></li><li><a href="ch03.html#earleymapping06"><span class="number">3<span class="sep">.</span>7<span class="sep"> </span></span>Mapping “x1**x2”</a></li><li><a href="ch03.html#earleymapping07"><span class="number">3<span class="sep">.</span>8<span class="sep"> </span></span>Mapping “x1++x2”</a></li><li><a href="ch03.html#earleymapping08"><span class="number">3<span class="sep">.</span>9<span class="sep"> </span></span>Mapping ¯\_(ツ)_/¯</a></li><li><a href="ch03.html#dashetc"><span class="number">3<span class="sep">.</span>10<span class="sep"> </span></span>A word about “-”, “@”, and “^”</a></li><li><a href="ch03.html#insertions"><span class="number">3<span class="sep">.</span>11<span class="sep"> </span></span>Insertions</a></li></ul></li><li><a href="ch04.html"><span class="number">4<span class="sep">. </span></span>Finding errors</a></li><li><a href="ch05.html"><span class="number">5<span class="sep">. </span></span>Ambiguity</a></li><li><a href="ch06.html"><span class="number">6<span class="sep">. </span></span>Configuration</a></li><li><a href="ch07.html"><span class="number">7<span class="sep">. </span></span>Output formats</a><ul class="toc"><li><a href="ch07.html#output-xml"><span class="number">7<span class="sep">.</span>1<span class="sep"> </span></span>XML</a></li><li><a href="ch07.html#output-json"><span class="number">7<span class="sep">.</span>2<span class="sep"> </span></span>JSON</a></li><li><a href="ch07.html#output-csv"><span class="number">7<span class="sep">.</span>3<span class="sep"> </span></span>CSV</a></li></ul></li><li><a href="ch08.html"><span class="number">8<span class="sep">. </span></span>Pragmas</a><ul class="toc"><li><a href="ch08.html#pragmas-grammar"><span class="number">8<span class="sep">.</span>1<span class="sep"> </span></span>Grammar pragmas</a><ul class="toc"><li><a href="ch08.html#pragma-csv-columns"><span class="number">8<span class="sep">.</span>1<span class="sep">.</span>1<span class="sep"> </span></span>csv-columns</a></li><li><a href="ch08.html#pragma-import"><span class="number">8<span class="sep">.</span>1<span class="sep">.</span>2<span class="sep"> </span></span>import</a></li><li><a href="ch08.html#pragma-ns"><span class="number">8<span class="sep">.</span>1<span class="sep">.</span>3<span class="sep"> </span></span>ns</a></li><li><a href="ch08.html#pragma-record-end"><span class="number">8<span class="sep">.</span>1<span class="sep">.</span>4<span class="sep"> </span></span>record-end</a></li><li><a href="ch08.html#pragma-record-start"><span class="number">8<span class="sep">.</span>1<span class="sep">.</span>5<span class="sep"> </span></span>record-start</a></li></ul></li><li><a href="ch08.html#pragmas-rules"><span class="number">8<span class="sep">.</span>2<span class="sep"> </span></span>Rule pragmas</a><ul class="toc"><li><a href="ch08.html#pragma-csv-heading"><span class="number">8<span class="sep">.</span>2<span class="sep">.</span>1<span class="sep"> </span></span>csv-heading</a></li><li><a href="ch08.html#pragma-discard-empty"><span class="number">8<span class="sep">.</span>2<span class="sep">.</span>2<span class="sep"> </span></span>discard-empty</a></li><li><a href="ch08.html#pragma-combine"><span class="number">8<span class="sep">.</span>2<span class="sep">.</span>3<span class="sep"> </span></span>combine</a></li><li><a href="ch08.html#pragma-regex"><span class="number">8<span class="sep">.</span>2<span class="sep">.</span>4<span class="sep"> </span></span>regex</a></li></ul></li><li><a href="ch08.html#pragmas-symbols"><span class="number">8<span class="sep">.</span>3<span class="sep"> </span></span>Symbol pragmas</a><ul class="toc"><li><a href="ch08.html#pragma-rename"><span class="number">8<span class="sep">.</span>3<span class="sep">.</span>1<span class="sep"> </span></span>rename</a></li><li><a href="ch08.html#pragma-rewrite"><span class="number">8<span class="sep">.</span>3<span class="sep">.</span>2<span class="sep"> </span></span>rewrite</a></li></ul></li></ul></li><li><a href="ch09.html"><span class="number">9<span class="sep">. </span></span>Parsing records</a></li><li><a href="appa.html"><span class="label">Appendix<span class="sep"> </span></span><span class="number">A<span class="sep">. </span></span>Property files</a><ul class="toc"><li><a href="appa.html#pf001"><span class="number">A<span class="sep">.</span>1<span class="sep"> </span></span>A first attempt</a></li><li><a href="appa.html#pf002"><span class="number">A<span class="sep">.</span>2<span class="sep"> </span></span>Refining name-value</a></li><li><a href="appa.html#pf003"><span class="number">A<span class="sep">.</span>3<span class="sep"> </span></span>More line options</a></li><li><a href="appa.html#pf004"><span class="number">A<span class="sep">.</span>4<span class="sep"> </span></span>Character escapes</a></li><li><a href="appa.html#pf005"><span class="number">A<span class="sep">.</span>5<span class="sep"> </span></span>Challenges for the reader</a></li></ul></li><li><a href="appb.html"><span class="label">Appendix<span class="sep"> </span></span><span class="number">B<span class="sep">. </span></span>Caching</a></li><li><a href="appc.html"><span class="label">Appendix<span class="sep"> </span></span><span class="number">C<span class="sep">. </span></span>Change log</a></li></ul></div></script></nav><script src="/js/persistent-toc.js"></script><script src="/js/chunk-nav.js"></script></body></html>