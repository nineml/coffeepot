<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" class="no-js"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script><title>Appendix A. Property files</title><link href="/css/pygments.css" rel="stylesheet"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link href="https://purl.org/dc/elements/1.1/" rel="schema.dc"/><meta name="dc.modified" content="2023-07-23T09:22:34Z"/><meta name="generator" content="DocBook xslTNG version 2.1.6 / cf0b935 / SAXON EE 12.3"/><link href="/css/docbook-toc.css" rel="stylesheet"/><link href="/css/docbook.css" rel="stylesheet" media="screen"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><script src="https://kit.fontawesome.com/498b6706f0.js" type="text/javascript" crossorigin="anonymous"></script><link href="icon/CoffeePot.png" rel="shortcut icon"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link href="css/nineml.css" rel="stylesheet"/><link href="css/coffeepot.css" rel="stylesheet"/><link rel="prev" href="ch10.html"/><link rel="next" href="ch11.html"/><link rel="up" href="index.html"/><link rel="home" href="index.html"/><script src="/js/persistent-toc.js" defer="defer"></script><script src="/js/copy-verbatim.js" defer="defer"></script><script src="/js/chunk-nav.js" defer="defer"></script></head><body><nav class="top"><span class="nav"><a title="CoffeePot" href="index.html"><i class="fas fa-home"></i></a> <a href="ch10.html" title="Chapter  10 .  Parsing records"><i class="fas fa-arrow-left"></i></a> <a title="CoffeePot" href="index.html"><i class="fas fa-arrow-up"></i></a> <a title="Chapter  11 .  Diagrams" href="ch11.html"><i class="fas fa-arrow-right"></i></a></span><span class="title"><i class="title">CoffeePot</i></span></nav><main><section id="property-files" db-chunk="appa.html" db-id="d94e1577" class="appendix component"><header><h2>Appendix <span class="label">A</span><span class="sep">. </span>Property files</h2><h3>A worked example</h3></header><p>Introduction…</p><section id="pf001" class="section"><header><h2><span class="label">A<span class="sep">.</span>1</span><span class="sep">. </span>A first attempt</h2></header><p>Suppose that we wanted to read Java-style property files, like this one:</p><div class="pre-wrap" db-startinglinenumber="1" db-numberoflines="3"><pre class="language-none numbered programlisting verbatim verblines"><span class="line" db-line="1"><span class="ln">  <span class="nsep">|</span></span><span class="ld"><code># This is a comment.</code></span></span>
<span class="line" db-line="2"><span class="ln">  <span class="nsep">|</span></span><span class="ld"><code>name1 : value1</code></span></span>
<span class="line" db-line="3"><span class="ln">  <span class="nsep">|</span></span><span class="ld"><code>name2 = value2</code></span></span>
</pre></div><p>Where:</p><ol class="orderedlist" type="1"><li><p>Lines consist of name/value pairs, separated by “:” or
“=”; whitespace around the separator is irrelevant.</p></li><li><p>If the first non-whitespace character in a line is “!” or “#”,
it is a comment.</p></li></ol><p>Our first attempt to parse this grammar might look something like
<a href="examples/prop1.ixml" class="link">prop1.ixml</a>:</p><div class="programlistingco"><div class="pre-wrap" db-startinglinenumber="1" db-numberoflines="9"><pre class="language-none long numbered programlisting verbatim verblines"><span class="line" db-line="1"><span class="ln">1 <span class="nsep">|</span></span><span class="ld"><code>property-file: line+ .                           <a id="p1l1" class="callout-bug linecolumn" db-line="1" db-column="50">①</a></code></span></span>
<span class="line" db-line="2"><span class="ln">  <span class="nsep">|</span></span><span class="ld"><code>-line: comment ; name-value .                    <a id="p1l2" class="callout-bug linecolumn" db-line="2" db-column="50">②</a></code></span></span>
<span class="line" db-line="3"><span class="ln">  <span class="nsep">|</span></span><span class="ld"><code> </code></span></span>
<span class="line" db-line="4"><span class="ln">  <span class="nsep">|</span></span><span class="ld"><code>comment: s, -["#!"], char*, NL .                 <a id="p1l4" class="callout-bug linecolumn" db-line="4" db-column="50">③</a></code></span></span>
<span class="line" db-line="5"><span class="ln">5 <span class="nsep">|</span></span><span class="ld"><code>name-value: char*, NL .                          <a id="p1l5" class="callout-bug linecolumn" db-line="5" db-column="50">④</a></code></span></span>
<span class="line" db-line="6"><span class="ln">  <span class="nsep">|</span></span><span class="ld"><code> </code></span></span>
<span class="line" db-line="7"><span class="ln">  <span class="nsep">|</span></span><span class="ld"><code>-NL: -#a ; -#d, -#a .                            <a id="p1l7" class="callout-bug linecolumn" db-line="7" db-column="50">⑤</a></code></span></span>
<span class="line" db-line="8"><span class="ln">  <span class="nsep">|</span></span><span class="ld"><code>-char: ~[#a] .</code></span></span>
<span class="line" db-line="9"><span class="ln">  <span class="nsep">|</span></span><span class="ld"><code>-s: (-[Zs]; -#9; -#d)* .</code></span></span>
</pre></div><div class="calloutlist"><dl><dt class="callout"><a class="callout-bug" href="#p1l1">①</a></dt><dd><p>This grammar says, roughly: a property file consists of one or more lines.
      </p></dd><dt class="callout"><a class="callout-bug" href="#p1l2">②</a></dt><dd><p>A line is either a comment or a <code>name-value</code>.
      </p></dd><dt class="callout"><a class="callout-bug" href="#p1l4">③</a></dt><dd><p>A comment is whitespace followed by a “#” or a “!”, followed by any characters
up to the end of the line.
      </p></dd><dt class="callout"><a class="callout-bug" href="#p1l5">④</a></dt><dd><p>A <code>name-value</code> is any character up to the end of the line. (This
is clearly a toy definition that we’ll be refining.)
      </p></dd><dt class="callout"><a class="callout-bug" href="#p1l7">⑤</a></dt><dd><p>A <code>NL</code> is either a linefeed or a carriage return followed by a linefeed.
A <code>char</code> is anything except a linefeed. And <code>s</code>, whitespace, is any
sequence of zero or more <a href="https://www.fileformat.info/info/unicode/category/Zs/list.htm" class="link">space separators</a>, tabs, or carriage returns.
      </p></dd></dl></div></div><p>Judicious use of “-” characters before terminals and
non-terminals keeps the output clean. If you run this through
<span class="application">coffeepot</span>, you’ll get:</p><div class="pre-wrap"><pre class="screen verbatim verblines"><span class="line" db-line="1"><span class="ln">  <span class="nsep">|</span></span><span class="ld"><code><code class="computeroutput">$ coffeepot -v -g:examples/prop1.ixml -i:examples/example1.properties -pp</code></code></span></span>
<span class="line" db-line="2"><span class="ln">  <span class="nsep">|</span></span><span class="ld"><code><code class="computeroutput">Loading ixml grammar: examples/prop1.ixml</code></code></span></span>
<span class="line" db-line="3"><span class="ln">  <span class="nsep">|</span></span><span class="ld"><code><code class="computeroutput">Loading input from examples/example1.properties</code></code></span></span>
<span class="line" db-line="4"><span class="ln">  <span class="nsep">|</span></span><span class="ld"><code><code class="computeroutput">There are 2 possible parses.</code></code></span></span>
<span class="line" db-line="5"><span class="ln">  <span class="nsep">|</span></span><span class="ld"><code><code class="computeroutput">&lt;property-file xmlns:ixml="http://invisiblexml.org/NS" ixml:state="ambiguous"&gt;</code></code></span></span>
<span class="line" db-line="6"><span class="ln">  <span class="nsep">|</span></span><span class="ld"><code><code class="computeroutput">   &lt;name-value&gt;# This is a comment.&lt;/name-value&gt;</code></code></span></span>
<span class="line" db-line="7"><span class="ln">  <span class="nsep">|</span></span><span class="ld"><code><code class="computeroutput">   &lt;name-value&gt;name1 : value1&lt;/name-value&gt;</code></code></span></span>
<span class="line" db-line="8"><span class="ln">  <span class="nsep">|</span></span><span class="ld"><code><code class="computeroutput">   &lt;name-value&gt;name2 = value2&lt;/name-value&gt;</code></code></span></span>
<span class="line" db-line="9"><span class="ln">  <span class="nsep">|</span></span><span class="ld"><code><code class="computeroutput">&lt;/property-file&gt;</code></code></span></span>
</pre></div><p>That looks reasonable for our initial grammar, but you might
wonder where the ambiguity arises. Let’s find out with the <a href="ch02.html#_describe-ambiguity"><code class="option">--describe-ambiguity</code></a>
option:</p><div class="pre-wrap"><pre class="screen verbatim verblines"><span class="line" db-line="1"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><code class="computeroutput">$ coffeepot -v -g:examples/prop1.ixml -i:examples/example1.properties --describe-ambiguity -pp</code></code></span></span>
<span class="line" db-line="2"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><code class="computeroutput">Loading ixml grammar: examples/prop1.ixml</code></code></span></span>
<span class="line" db-line="3"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><code class="computeroutput">Loading input from examples/example1.properties</code></code></span></span>
<span class="line" db-line="4"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><code class="computeroutput">There are 2 possible parses.</code></code></span></span>
<span class="line" db-line="5"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><code class="computeroutput">Ambiguity:</code></code></span></span>
<span class="line" db-line="6"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><code class="computeroutput">$2, 0, 51</code></code></span></span>
<span class="line" db-line="7"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><code class="computeroutput">        line, 0, 21 / $3ⁿ, 21, 51</code></code></span></span>
<span class="line" db-line="8"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><code class="computeroutput">        line, 0, 21 / $3ⁿ, 21, 51</code></code></span></span>
<span class="line" db-line="9"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><code class="computeroutput">&lt;property-file xmlns:ixml="http://invisiblexml.org/NS" ixml:state="ambiguous"&gt;</code></code></span></span>
<span class="line" db-line="10"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><code class="computeroutput">   &lt;name-value&gt;# This is a comment.&lt;/name-value&gt;</code></code></span></span>
<span class="line" db-line="11"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><code class="computeroutput">   &lt;name-value&gt;name1 : value1&lt;/name-value&gt;</code></code></span></span>
<span class="line" db-line="12"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><code class="computeroutput">   &lt;name-value&gt;name2 = value2&lt;/name-value&gt;</code></code></span></span>
<span class="line" db-line="13"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code><code class="computeroutput">&lt;/property-file&gt;</code></code></span></span>
</pre></div><p>When you ask <span class="application">coffeepot</span> to describe ambiguity, or when
it fails to parse your document and attempts to report errors, it has little choice
at the moment except to expose some of the inner workings of the parser.
This is described more thoroughly in <a href="ch03.html" class="xref xref-chapter">Chapter <span class="label">3</span>, How it works</a>.
</p><p>This output indicates that the nonterminal “$2”, covering the range of
characters 0-51 has two different derivations. Sometimes it’s useful to look at the graph
. You can get an SVG version of it with the <code class="option">--graph-svg</code> option:</p><div id="prop1.svg" class="figure formalobject"><header><div class="title">Figure <span class="label">A<span class="sep">.</span>1</span><span class="sep">. </span>Part of the parse forest</div></header><div class="mediaobject"><div class="media image"><picture class="imageobject"><img src="/images/prop1.png"/></picture></div></div></div><p>There you can see that the culprit is that a line can be either
a <code>comment</code> or a <code>name-value</code>. Does that seem strange?
Well, look back at our proto-grammar:</p><div class="pre-wrap" db-startinglinenumber="1" db-numberoflines="2"><pre class="language-none numbered programlisting verbatim verblines"><span class="line" db-line="1"><span class="ln">  <span class="nsep">|</span></span><span class="ld"><code>comment: s, -["#!"], char*, NL .</code></span></span>
<span class="line" db-line="2"><span class="ln">  <span class="nsep">|</span></span><span class="ld"><code>name-value: char*, NL .</code></span></span>
</pre></div><p>It says that a comment has to begin with a “#” or “!”, so line 1
could be a comment, but all that <code>name-value</code> says at the moment is that
it doesn’t include newlines. So it could also match the first line!
</p></section><section id="pf002" class="section"><header><h2><span class="label">A<span class="sep">.</span>2</span><span class="sep">. </span>Refining name-value</h2></header><p>It’s reasonably straight-forward to improve on <code>name-value</code>
in <a href="examples/prop2.ixml" class="link">prop2.ixml</a>:</p><div class="pre-wrap" db-startinglinenumber="6" db-numberoflines="6"><pre class="language-none long numbered programlisting verbatim verblines"><span class="line" db-line="1"><span class="ln"> 6 <span class="nsep">|</span></span><span class="ld"><code>name-value: s, name, s, -[":="], s, value, NL.</code></span></span>
<span class="line" db-line="2"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>name: namestart, namefollower* .</code></span></span>
<span class="line" db-line="3"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>value: ~[Zs; #9; #d], char* .</code></span></span>
<span class="line" db-line="4"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code> </code></span></span>
<span class="line" db-line="5"><span class="ln">10 <span class="nsep">|</span></span><span class="ld"><code>-namestart: ["_"; L] .</code></span></span>
<span class="line" db-line="6"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>-namefollower: namestart; ["-.·‿⁀"; Nd; Mn] .</code></span></span>
</pre></div><p>Here we’re saying that a <code>name-value</code> is a name, followed
by a “:” or “=” separator, followed by a value; a name is a name start character
followed by zero or more name follower characters, and a value is something
that isn’t whitespace followed by any characters.</p><p>This does a good job on our sample file:</p><div class="pre-wrap" db-startinglinenumber="1" db-numberoflines="14"><pre class="language-none long numbered programlisting verbatim verblines"><span class="line" db-line="1"><span class="ln"> 1 <span class="nsep">|</span></span><span class="ld"><code>$ coffeepot -v -g:examples/prop2.ixml -i:examples/example1.properties -pp</code></span></span>
<span class="line" db-line="2"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>Loading ixml grammar: examples/prop2.ixml</code></span></span>
<span class="line" db-line="3"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>Loading input from examples/example1.properties</code></span></span>
<span class="line" db-line="4"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>&lt;property-file&gt;</code></span></span>
<span class="line" db-line="5"><span class="ln"> 5 <span class="nsep">|</span></span><span class="ld"><code>   &lt;comment&gt; This is a comment.&lt;/comment&gt;</code></span></span>
<span class="line" db-line="6"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>   &lt;name-value&gt;</code></span></span>
<span class="line" db-line="7"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>      &lt;name&gt;name1&lt;/name&gt;</code></span></span>
<span class="line" db-line="8"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>      &lt;value&gt;value1&lt;/value&gt;</code></span></span>
<span class="line" db-line="9"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>   &lt;/name-value&gt;</code></span></span>
<span class="line" db-line="10"><span class="ln">10 <span class="nsep">|</span></span><span class="ld"><code>   &lt;name-value&gt;</code></span></span>
<span class="line" db-line="11"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>      &lt;name&gt;name2&lt;/name&gt;</code></span></span>
<span class="line" db-line="12"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>      &lt;value&gt;value2&lt;/value&gt;</code></span></span>
<span class="line" db-line="13"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>   &lt;/name-value&gt;</code></span></span>
<span class="line" db-line="14"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>&lt;/property-file&gt;</code></span></span>
</pre></div></section><section id="pf003" class="section"><header><h2><span class="label">A<span class="sep">.</span>3</span><span class="sep">. </span>More line options</h2></header><p>The format for property files is actually a bit more complicated.
They allow blank lines, continuation lines, and several flavors of escaped
characters:</p><div class="pre-wrap" db-startinglinenumber="1" db-numberoflines="10"><pre class="language-none long numbered programlisting verbatim verblines"><span class="line" db-line="1"><span class="ln"> 1 <span class="nsep">|</span></span><span class="ld"><code># This is a comment.</code></span></span>
<span class="line" db-line="2"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>name1 : value1</code></span></span>
<span class="line" db-line="3"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>name2 = value2</code></span></span>
<span class="line" db-line="4"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>name3 = apple,\</code></span></span>
<span class="line" db-line="5"><span class="ln"> 5 <span class="nsep">|</span></span><span class="ld"><code>        banana,\</code></span></span>
<span class="line" db-line="6"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>        pear</code></span></span>
<span class="line" db-line="7"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code> </code></span></span>
<span class="line" db-line="8"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>name4 = a\tb</code></span></span>
<span class="line" db-line="9"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>name5 = a\u2192b</code></span></span>
<span class="line" db-line="10"><span class="ln">10 <span class="nsep">|</span></span><span class="ld"><code>name6 = c:\\path\\to\\thing</code></span></span>
</pre></div><p>In fact, the format
<a href="https://docs.oracle.com/javase/7/docs/api/java/util/Properties.html#load(java.io.Reader)" class="link">as described by Java</a> allows even more escaping,
and allows names without values, which we’re not going to try to cover
now. The Java description is a fine example of a messy, procedural
description of a file format. Their parsing description is explicitly
two-pass, though it’s unclear if that’s necessary or if the author was
just describing what their code does.
</p><p>Before looking at the solution, have a go at extending the
grammar to support blank lines and continuations. Blank lines are
easy, continuations are a little more complicated.</p><div class="mediaobject"><div class="media image"><picture class="imageobject"><img src="/images/SpoilerBreak.png"/></picture></div></div><p>Here’s one solution:
in <a href="examples/prop3.ixml" class="link">prop3.ixml</a>:</p><div class="programlistingco"><div class="pre-wrap" db-startinglinenumber="2" db-numberoflines="11"><pre class="language-none long numbered programlisting verbatim verblines"><span class="line" db-line="1"><span class="ln"> 2 <span class="nsep">|</span></span><span class="ld"><code>-line: blank ; comment ; name-value .            <a id="p2l1" class="callout-bug linecolumn" db-line="1" db-column="50">①</a></code></span></span>
<span class="line" db-line="2"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code> </code></span></span>
<span class="line" db-line="3"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>blank: s, NL .                                   <a id="p2l3" class="callout-bug linecolumn" db-line="3" db-column="50">②</a></code></span></span>
<span class="line" db-line="4"><span class="ln"> 5 <span class="nsep">|</span></span><span class="ld"><code>comment: s, -["#!"], char*, NL .</code></span></span>
<span class="line" db-line="5"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code> </code></span></span>
<span class="line" db-line="6"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>name-value: s, name, s, -[":="], s, value .</code></span></span>
<span class="line" db-line="7"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>value: simple-value ; extended-value .           <a id="p2l7" class="callout-bug linecolumn" db-line="7" db-column="50">③</a></code></span></span>
<span class="line" db-line="8"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>-simple-value: atomic-value, NL .                <a id="p2l8" class="callout-bug linecolumn" db-line="8" db-column="50">④</a></code></span></span>
<span class="line" db-line="9"><span class="ln">10 <span class="nsep">|</span></span><span class="ld"><code>-extended-value: atomic-value, -"\", NL, s, -value .  <a id="p2l9" class="callout-bug linecolumn" db-line="9" db-column="55">⑤</a></code></span></span>
<span class="line" db-line="10"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>-atomic-value: ~[Zs; #9; #d], char* .            <a id="p2l10" class="callout-bug linecolumn" db-line="10" db-column="50">⑥</a></code></span></span>
<span class="line" db-line="11"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>                                                 <a id="p2l11" class="callout-bug linecolumn" db-line="11" db-column="50">⑦</a></code></span></span>
</pre></div><div class="calloutlist"><dl><dt class="callout"><a class="callout-bug" href="#p2l1">①</a><a class="callout-bug" href="#p2l3">②</a></dt><dd><p>A blank line is another kind of line, it consists entirely of whitespace.
</p></dd><dt class="callout"><a class="callout-bug" href="#p2l7">③</a></dt><dd><p>A <code>name-value</code> no longer includes the newline because
we have address continuations. (If it weren’t for continuations, this grammar
could be written more simply as a series of lines separated by newlines:
<code>property-file: line+#a.</code>.)
</p></dd><dt class="callout"><a class="callout-bug" href="#p2l8">④</a></dt><dd><p>A value is now either a simple value or an extended value.
</p></dd><dt class="callout"><a class="callout-bug" href="#p2l9">⑤</a></dt><dd><p>A simple value is an atomic value followed by a newline.
</p></dd><dt class="callout"><a class="callout-bug" href="#p2l10">⑥</a></dt><dd><p>An extended value is an atomic value that ends with a backslash
followed by a newline. That’s followed by whitespace and another value.
This recursive definition assures that if there are several continuations,
we catch them all.
</p></dd><dt class="callout"><a class="callout-bug" href="#p2l11">⑦</a></dt><dd><p>Finally, an atomic value is just a non-whitespace characater followed
by more characters. It will always be bounded by the nonterminal that
refers to it.
</p></dd></dl></div></div><p>Now we get:</p><div class="pre-wrap" db-startinglinenumber="1" db-numberoflines="31"><pre class="language-none long numbered programlisting verbatim verblines"><span class="line" db-line="1"><span class="ln"> 1 <span class="nsep">|</span></span><span class="ld"><code>$ coffeepot -v -g:examples/prop3.ixml -i:examples/example.properties --describe-ambiguity -pp</code></span></span>
<span class="line" db-line="2"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>Loading ixml grammar: examples/prop3.ixml</code></span></span>
<span class="line" db-line="3"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>Loading input from examples/example.properties</code></span></span>
<span class="line" db-line="4"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>&lt;property-file&gt;</code></span></span>
<span class="line" db-line="5"><span class="ln"> 5 <span class="nsep">|</span></span><span class="ld"><code>   &lt;comment&gt; This is a comment.&lt;/comment&gt;</code></span></span>
<span class="line" db-line="6"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>   &lt;name-value&gt;</code></span></span>
<span class="line" db-line="7"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>      &lt;name&gt;name1&lt;/name&gt;</code></span></span>
<span class="line" db-line="8"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>      &lt;value&gt;value1&lt;/value&gt;</code></span></span>
<span class="line" db-line="9"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>   &lt;/name-value&gt;</code></span></span>
<span class="line" db-line="10"><span class="ln">10 <span class="nsep">|</span></span><span class="ld"><code>   &lt;name-value&gt;</code></span></span>
<span class="line" db-line="11"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>      &lt;name&gt;name2&lt;/name&gt;</code></span></span>
<span class="line" db-line="12"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>      &lt;value&gt;value2&lt;/value&gt;</code></span></span>
<span class="line" db-line="13"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>   &lt;/name-value&gt;</code></span></span>
<span class="line" db-line="14"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>   &lt;name-value&gt;</code></span></span>
<span class="line" db-line="15"><span class="ln">15 <span class="nsep">|</span></span><span class="ld"><code>      &lt;name&gt;name3&lt;/name&gt;</code></span></span>
<span class="line" db-line="16"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>      &lt;value&gt;apple,banana,pear&lt;/value&gt;</code></span></span>
<span class="line" db-line="17"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>   &lt;/name-value&gt;</code></span></span>
<span class="line" db-line="18"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>   &lt;blank/&gt;</code></span></span>
<span class="line" db-line="19"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>   &lt;name-value&gt;</code></span></span>
<span class="line" db-line="20"><span class="ln">20 <span class="nsep">|</span></span><span class="ld"><code>      &lt;name&gt;name4&lt;/name&gt;</code></span></span>
<span class="line" db-line="21"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>      &lt;value&gt;a\tb&lt;/value&gt;</code></span></span>
<span class="line" db-line="22"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>   &lt;/name-value&gt;</code></span></span>
<span class="line" db-line="23"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>   &lt;name-value&gt;</code></span></span>
<span class="line" db-line="24"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>      &lt;name&gt;name5&lt;/name&gt;</code></span></span>
<span class="line" db-line="25"><span class="ln">25 <span class="nsep">|</span></span><span class="ld"><code>      &lt;value&gt;a\u2192b &lt;/value&gt;</code></span></span>
<span class="line" db-line="26"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>   &lt;/name-value&gt;</code></span></span>
<span class="line" db-line="27"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>   &lt;name-value&gt;</code></span></span>
<span class="line" db-line="28"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>      &lt;name&gt;name6&lt;/name&gt;</code></span></span>
<span class="line" db-line="29"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>      &lt;value&gt;c:\\path\\to\\thing&lt;/value&gt;</code></span></span>
<span class="line" db-line="30"><span class="ln">30 <span class="nsep">|</span></span><span class="ld"><code>   &lt;/name-value&gt;</code></span></span>
<span class="line" db-line="31"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>&lt;/property-file&gt;</code></span></span>
</pre></div><p>Note that “apple”, “banana”, and “pear” have been correctly combined
into a single value. The blank line is explicit, but we could suppress it by
putting “-” before it’s name.</p></section><section id="pf004" class="section"><header><h2><span class="label">A<span class="sep">.</span>4</span><span class="sep">. </span>Character escapes</h2></header><p>The last thing we’ll look at are characater escapes. The property file
format says that tab, carriage return, and newline can be escaped as
“\t”, “\r”, and “\n”, respectively. This also requires introducing an escape
for “\”, “\\”. In addition, Java-style Unicode references are allowed:
“\uHHHH” where “HHHH” is any four hexidecimal digits.</p><p>As before, you might want to think about this before you look at the
solution.</p><div class="mediaobject"><div class="media image"><picture class="imageobject"><img src="/images/SpoilerBreak.png"/></picture></div></div><p>The solution
in <a href="examples/prop4.ixml" class="link">prop4.ixml</a> is:</p><div class="pre-wrap" db-startinglinenumber="21" db-numberoflines="9"><pre class="language-none long numbered programlisting verbatim verblines"><span class="line" db-line="1"><span class="ln">21 <span class="nsep">|</span></span><span class="ld"><code>-char: ~["\";#a] ; tab; cr ; nl ; bs ; uref .</code></span></span>
<span class="line" db-line="2"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code> </code></span></span>
<span class="line" db-line="3"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>tab: -"\t" .</code></span></span>
<span class="line" db-line="4"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>cr: -"\r" .</code></span></span>
<span class="line" db-line="5"><span class="ln">25 <span class="nsep">|</span></span><span class="ld"><code>nl: -"\n" .</code></span></span>
<span class="line" db-line="6"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>-bs: "\", -"\" .</code></span></span>
<span class="line" db-line="7"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code> </code></span></span>
<span class="line" db-line="8"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>uref: -"\u", digit, digit, digit, digit .</code></span></span>
<span class="line" db-line="9"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>-digit: ["0"-"9"; "a"-"f"; "A"-"F"] .</code></span></span>
</pre></div><p>We augment <code>char</code> so that it’s a non-backslash character or
a backslash followed by one of “t”, “r”, “n”, or “\”. Or it’s a “\u”
followed by four hexidecimal digits.</p><p>Here we encounter an interesting consequence of the design of
Invisible XML version 1.0. Although for the “\\” case, we can suppress
one backslash and output the other, there’s nothing we can do, for
example, to replace “\t” with a literal tab character. Instead,
we leave <code>&lt;tab/&gt;</code>, etc. in the output where they can be
cleaned up later.</p><div class="pre-wrap" db-startinglinenumber="1" db-numberoflines="31"><pre class="language-none long numbered programlisting verbatim verblines"><span class="line" db-line="1"><span class="ln"> 1 <span class="nsep">|</span></span><span class="ld"><code>$ coffeepot -v -g:examples/prop4.ixml -i:examples/example.properties --describe-ambiguity -pp</code></span></span>
<span class="line" db-line="2"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>Loading ixml grammar: examples/prop4.ixml</code></span></span>
<span class="line" db-line="3"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>Loading input from examples/example.properties</code></span></span>
<span class="line" db-line="4"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>&lt;property-file&gt;</code></span></span>
<span class="line" db-line="5"><span class="ln"> 5 <span class="nsep">|</span></span><span class="ld"><code>   &lt;comment&gt; This is a comment.&lt;/comment&gt;</code></span></span>
<span class="line" db-line="6"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>   &lt;name-value&gt;</code></span></span>
<span class="line" db-line="7"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>      &lt;name&gt;name1&lt;/name&gt;</code></span></span>
<span class="line" db-line="8"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>      &lt;value&gt;value1&lt;/value&gt;</code></span></span>
<span class="line" db-line="9"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>   &lt;/name-value&gt;</code></span></span>
<span class="line" db-line="10"><span class="ln">10 <span class="nsep">|</span></span><span class="ld"><code>   &lt;name-value&gt;</code></span></span>
<span class="line" db-line="11"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>      &lt;name&gt;name2&lt;/name&gt;</code></span></span>
<span class="line" db-line="12"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>      &lt;value&gt;value2&lt;/value&gt;</code></span></span>
<span class="line" db-line="13"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>   &lt;/name-value&gt;</code></span></span>
<span class="line" db-line="14"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>   &lt;name-value&gt;</code></span></span>
<span class="line" db-line="15"><span class="ln">15 <span class="nsep">|</span></span><span class="ld"><code>      &lt;name&gt;name3&lt;/name&gt;</code></span></span>
<span class="line" db-line="16"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>      &lt;value&gt;apple,banana,pear&lt;/value&gt;</code></span></span>
<span class="line" db-line="17"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>   &lt;/name-value&gt;</code></span></span>
<span class="line" db-line="18"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>   &lt;blank/&gt;</code></span></span>
<span class="line" db-line="19"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>   &lt;name-value&gt;</code></span></span>
<span class="line" db-line="20"><span class="ln">20 <span class="nsep">|</span></span><span class="ld"><code>      &lt;name&gt;name4&lt;/name&gt;</code></span></span>
<span class="line" db-line="21"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>      &lt;value&gt;a&lt;tab/&gt;b&lt;/value&gt;</code></span></span>
<span class="line" db-line="22"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>   &lt;/name-value&gt;</code></span></span>
<span class="line" db-line="23"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>   &lt;name-value&gt;</code></span></span>
<span class="line" db-line="24"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>      &lt;name&gt;name5&lt;/name&gt;</code></span></span>
<span class="line" db-line="25"><span class="ln">25 <span class="nsep">|</span></span><span class="ld"><code>      &lt;value&gt;a&lt;uref&gt;2192&lt;/uref&gt;b &lt;/value&gt;</code></span></span>
<span class="line" db-line="26"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>   &lt;/name-value&gt;</code></span></span>
<span class="line" db-line="27"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>   &lt;name-value&gt;</code></span></span>
<span class="line" db-line="28"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>      &lt;name&gt;name6&lt;/name&gt;</code></span></span>
<span class="line" db-line="29"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>      &lt;value&gt;c:\path\to\thing&lt;/value&gt;</code></span></span>
<span class="line" db-line="30"><span class="ln">30 <span class="nsep">|</span></span><span class="ld"><code>   &lt;/name-value&gt;</code></span></span>
<span class="line" db-line="31"><span class="ln">   <span class="nsep">|</span></span><span class="ld"><code>&lt;/property-file&gt;</code></span></span>
</pre></div></section><section id="pf005" class="section"><header><h2><span class="label">A<span class="sep">.</span>5</span><span class="sep">. </span>Challenges for the reader</h2></header><p>The example grammar in this chapter doesn’t cover all of the
features of property files. If you’re looking for a challenge,
consider these improvements:</p><ol class="orderedlist" type="1"><li><p>The property file format also specifies that unnecessarily escaped
characters are allowed, but the escaping is ignored. An occurrence of
<code>\"</code> is the same as <code>"</code>.</p></li><li><p>The property file format allows “=” and “:” to occur in property names
if they are escaped as <code>\=</code> and <code>\:</code>, respectively.
</p></li><li><p>In a property file, the “end of file” marks the end of a value. In
the grammar presented in this chapter, a terminating newline is required.
Can this be fixed?</p></li></ol></section></section></main><nav class="bottom"><div class="navrow"><div class="navleft"><a title="Chapter  10 .  Parsing records" href="ch10.html"><i class="fas fa-arrow-left"></i></a></div><div class="navmiddle"><a title="CoffeePot" href="index.html"><i class="fas fa-home"></i></a></div><div class="navright"><a title="Chapter  11 .  Diagrams" href="ch11.html"><i class="fas fa-arrow-right"></i></a></div></div><div class="navrow"><div class="navleft navtitle">Chapter  10 .  Parsing records</div><div class="navmiddle"><a title="CoffeePot" href="index.html"><i class="fas fa-arrow-up"></i></a></div><div class="navright navtitle">Chapter  11 .  Diagrams</div></div><div class="infofooter"><span class="copyrightfooter">Copyright © 2022–2023 Norman Walsh.</span></div><nav class="tocopen"></nav><nav class="toc"></nav><!-- Hide ToC details from user agents that don’t support JS --><script type="text/html" class="tocopen"><i class="far fa-book"></i></script><script type="text/html" class="toc"><header><span>Table of Contents</span><span class="close"><i class="far fa-window-close"></i></span><p class="ptoc-search"><input class="ptoc-search" placeholder="Search" style="width: 80%"/></p></header><div db-persistent-toc="persistent-toc.html" db-prefix="">Loading…</div></script></nav></body></html>